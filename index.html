<!DOCTYPE HTML>
<html>
<head>
	<title>Recipe Box</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	
	<!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>

	<!-- Bootstrap-->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<!-- React-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.1/react.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.1/react-dom.min.js"></script>

	<!-- CSS Stylesheet-->
	<link rel="stylesheet" href="recipe.css" type="text/css">

	<!--Babel compiler-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.js"></script>
</head>
<body>
	<div id="app"></div>

	<script type="text/babel">
	class RecipeBox extends React.Component {
		constructor(props) {
			super(props);
			this.state = {
				recipes: {
					brussel_sprouts: {
						title: 'Brussel Sprouts Pasta',
						recipe: 'Brussel Sprouts, Haloumi, Pasta',
						display: false,
						editable: false
					},
					viet_salad: {
						title: 'Vietnamese Salad',
						recipe: 'Carrots, cucumber, sprouts, tofu',
						display: false,
						editable: false
					}
				},
				recipe_form: {
					title: "Name of dish",
					recipe: "Recipe",
					display: false
				},
				recipe_store: {
					title: "",
					recipe: "",
					display: false,
					editable: false
				}
			};
			this.ToggleRecipes = this.ToggleRecipes.bind(this);
			this.ToggleForm = this.ToggleForm.bind(this);
			this.Edit = this.Edit.bind(this);
			this.Cancel = this.Cancel.bind(this);
			this.NewTitle = this.NewTitle.bind(this);
			this.NewRecipe = this.NewRecipe.bind(this);
			this.Save = this.Save.bind(this);
			this.ClassRecipeForm = this.ClassRecipeForm.bind(this);
		}
		//Cancels editing process.
		Cancel(key) {
			const recipes = this.state.recipes;
			const recipe_store = this.state.recipe_store;
			recipes[key] = {
				title: recipe_store.title,
				recipe: recipe_store.recipe,
				display: false,
				editable: false
			};
			this.setState({
				recipes
			});
		}
		//changes class of recipe box based on whether recipe form is hidden
		ClassRecipeForm(arg) {
			return (arg) ? "recipes_with_form" : "recipes_without_form";
		}
		//deletes existing recipe
		Delete(key) {
			const recipes = this.state.recipes;
			delete recipes[key];
			this.setState({
				recipes
			});
		}
		//toggles display property of form for editing existing recipe
		DisplayStatus(arg) {
			return (arg) ? "inline" : "none";
		}
		//edits existing recipe. Stores existing recipe in recipe_store during editing.
		Edit(key) {
			const recipes = this.state.recipes;
			const recipe_store = this.state.recipe_store;
			recipe_store.title = recipes[key]['title'];
			recipe_store.recipe = recipes[key]['recipe'];
			this.setState({
				recipe_store
			})
			recipes[key]['editable'] = true;
			this.setState({
				recipes
			});
		}
		//updates recipe when editing
		NewRecipe(event) {
			const recipe_form = this.state.recipe_form;
			recipe_form.recipe = event.target.value;
			this.setState({
				recipe_form
			});
		}
		//updates title of recipe when editing
		NewTitle(event) {
			const recipe_form = this.state.recipe_form;
			recipe_form.title = event.target.value;
			this.setState({
				recipe_form
			});
		}
		//saves new recipe added
		Save() {
			var dish_title = this.state.recipe_form.title;
			var dish_recipe = this.state.recipe_form.recipe;
			const recipes = this.state.recipes;
			recipes[dish_title] = {
				title: dish_title,
				recipe: dish_recipe,
				display: false
			};
			this.setState({
				recipes
			});	
		}
		//toggles form when clicking on 'add recipe'
		ToggleForm() {
			const recipe_form = this.state.recipe_form;
			var current_display = recipe_form['display'];
			recipe_form['display'] = (current_display) ? false : true;
			this.setState({
				recipe_form
			});
		}
		//Toggles recipes when clicking on title
		ToggleRecipes(key) {
			const recipes = this.state.recipes;
			var current_display = recipes[key]['display'];
			recipes[key]['display'] = (current_display) ? false : true;
			if (recipes[key]['editable'] === true) {
				return false
			}
			else {
				this.setState({
					recipes
				});	
			}	
		}
		//saves changes to existing recipe
		Update(key) {
			const update_title = this.state.recipe_form.title;
			const update_recipe = this.state.recipe_form.recipe;
			const recipes = this.state.recipes;
			recipes[key] = {
				title: update_title,
				recipe: update_recipe,
				display: false,
				editable: false
			};
			this.setState({
				recipes
			});
		}
		render() {
			return (
				<div className="container">
				<div className="head">
				<div className='title'>Recipe Box</div>
				<div style={{float: 'right'}}>
				<button className="button_add" onClick={this.ToggleForm}>Add Recipe</button>
				</div>
				</div>
				<div className="box">
				<div style={{display: 
					this.DisplayStatus(this.state.recipe_form.display)}}>
					<div className="form">
						<textarea className="textarea_title" value={this.state.recipe_form.title} onChange={this.NewTitle}></textarea>
						<textarea className="textarea_recipe" value={this.state.recipe_form.recipe} onChange={this.NewRecipe}></textarea>
						<div className="buttons_box">
							<button onClick={() =>{this.Save(); this.ToggleForm()}}>Save</button>
							<button onClick={() =>{this.ToggleForm()}}>Cancel</button>
						</div>
					</div>
				</div>			
				<div className={this.ClassRecipeForm(this.state.recipe_form.display)}>
				{Object.keys(this.state.recipes).map((key) => 
					<div>
						<h3 className="name" onClick={() => this.ToggleRecipes(key)}>{this.state.recipes[key]['title']}</h3>
					<div style={{display: 
					this.DisplayStatus(this.state.recipes[key]['editable'])}}>
						<textarea className="textarea_title" value={this.state.recipe_form.title} onChange={this.NewTitle}></textarea>
						<textarea className="textarea_recipe" value={this.state.recipe_form.recipe}  onChange={this.NewRecipe}></textarea>
						<div className="buttons_box">
							<button onClick={() => this.Update(key)}>Save</button>
							<button onClick={() => this.Cancel(key)}>Cancel</button>
						</div>
					</div>
					<div>
						<div style={{display: 
							this.DisplayStatus(this.state.recipes[key]['display'])}}>
							<div className="recipes">{this.state.recipes[key]['recipe']}</div>
							<div className="buttons_box">
								<button onClick={() => this.Delete(key)}>Delete</button>
								<button onClick={() => {this.Edit(key); this.ToggleRecipes(key)}}>Edit</button>
							</div>
						</div>
						</div>
						</div>)}
				</div>
				</div>
				<footer>
					<div>Created by <a href="https://sebgrebe.github.io/">sebgrebe</a> with <a href="https://facebook.github.io/react/"><img src="reactlogo.png" height="28px" /></a>
					</div>
				</footer>
				</div>
		)}
	}

//renders RecipeBox
ReactDOM.render(<RecipeBox />, document.getElementById('app'));

</script>

</body>
</html>